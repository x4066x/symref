# シンボル存在確認機能追加のPBI

## 概要
アナライザーに`hasSymbol`メソッドを実装し、シンボルの存在確認機能を共通化します。既存の`findDefinitionNode`メソッドをラップして、すべてのコマンドで一貫したシンボル検証とエラーメッセージを提供します。

## 目的
- シンボル存在確認を共通機能として実装し、各コマンドでの重複コードを削減する
- すべてのコマンドで一貫したエラーハンドリングを実現する
- 複雑なシンボル名や特殊文字を含むシンボル名の処理を改善する
- ユーザーに対して統一された明確なエラーメッセージを提供する

## 受け入れ基準
1. `SymbolFinder`クラスに`hasSymbol`メソッドが実装されている
2. すべてのコマンド（refs, dead, trace, callers）が新しい検証メソッドを使用している
3. エラーメッセージの形式と出力先（stderr）がすべてのコマンドで統一されている
4. 特殊文字を含むシンボル名（スペース、ドット、括弧など）が正しく処理される
5. 単体テストと統合テストが追加されている

## SBI（ステップバイステップ手順）

### ステップ1: `hasSymbol`メソッドの実装
- `SymbolFinder`クラスに`hasSymbol`メソッドを追加する
- 既存の`findDefinitionNode`メソッドをラップしたシンプルな実装にする
- メソッドの仕様：
  - 入力：シンボル名（文字列）
  - 出力：ブール値（シンボルが存在するかどうか）
- メソッドの単体テストを作成する

### ステップ2: `analyzeSymbol`メソッドの修正
- `SymbolReferenceAnalyzer`の`analyzeSymbol`メソッドを修正し、`hasSymbol`を使ったより明確なエラーハンドリングを実装
- エラーメッセージの形式を統一
- エラーハンドリングのテストケースを追加

### ステップ3: コマンドの修正 - refs
- `RefsCommand`を修正して新しい検証メソッドを使用するように変更
- カンマ区切りとスペース区切りの両方で一貫したエラー処理を実装
- 既存のテストケースを更新/追加

### ステップ4: コマンドの修正 - trace
- `TraceCommand`を修正して開始シンボルと終了シンボルの検証に`hasSymbol`を使用
- エラーメッセージの形式を統一
- 既存のテストケースを更新/追加

### ステップ5: コマンドの修正 - callers
- `CallersCommand`を修正して`hasSymbol`を使用するように変更
- 複数シンボル指定時のエラー処理を統一
- 既存のテストケースを更新/追加

### ステップ6: コマンドの修正 - dead
- `DeadCommand`に関連するシンボル検証があれば`hasSymbol`を使用するように修正
- エラーメッセージの形式を他コマンドと統一
- 必要に応じてテストケースを更新

### ステップ7: エラー出力の共通化
- すべてのコマンドで統一されたエラー表示方法を実装
- `OutputFormatter`クラスに共通のエラー出力メソッドを追加（必要に応じて）
- エラーが発生した場合の終了コード設定を統一

### ステップ8: 統合テスト
- 各コマンドが`hasSymbol`を正しく使用しているか確認する統合テストを作成
- 特殊なシンボル名のテストケースを追加（スペースを含む、ドット記法など）
- エラーメッセージの一貫性を検証するテスト

## 技術的詳細
- `hasSymbol`の実装は既存の`findDefinitionNode`メソッドを利用し、結果が`undefined`でないかどうかをチェックする単純なものにする
- エラーメッセージは全コマンドで統一し、`stderr`に出力する
- エラー発生時の終了コードは、エラーが1つでもあれば`1`、それ以外は`0`に統一する
- シンボル検証はパフォーマンスに影響する可能性があるため、必要な場合のみ行う最適化を検討する

## 参照するコード
- `src/analyzer/SymbolFinder.ts`の`findDefinitionNode`メソッド
- `src/analyzer/SymbolReferenceAnalyzer.ts`の`analyzeSymbol`メソッド
- 各コマンドクラス（`RefsCommand`, `TraceCommand`, `CallersCommand`, `DeadCommand`）

## 工数見積もり
- 開発期間: 3人日
- 難易度: 中 